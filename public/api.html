
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>API</title>
<style>
body {
  max-width: 800px;
  margin: 20px auto;
}
table {
  width: 100%;
  border-collapse: collapse;
}
table.c th, table.c td {
  text-align: center;
}
table th, table td {
  padding: 8px 10px;
  border: 1px solid #ccc;
}
table th {
  background: #f0f0f0
}
table td:empty {
  border-right: 1px solid #f0f0f0;
  border-left: 1px solid #f0f0f0;
  padding: 5px 10px;
  background: #f0f0f0
}
h2 {
  margin-top: 2em;
}
hr {
  margin: 5em 0 2em;
  height: 10px;
  background: #f0f0f0;
  border: 0;
}
.tab {
  text-align: center;
}
</style>
</head>
<body>
<div class="tab">
<button>管理后台接口</button>
<button>小程序端接口</button>
</div>
<hr class="admin"/>
<h1 id="">奈雪点单管理后台接口：</h1>
<p>请求统一前缀：
<a href="http://shop.datong0.com/api">http://shop.datong0.com/api</a></p>
<p>预览地址：
<a href="http://shop.datong0.com">http://shop.datong0.com</a></p>
<p>接口使用cookie鉴权</p>
<h2 id="errcode">errcode响应码含义：</h2>
<table>
<thead>
<tr>
<th style="text-align:center;">响应码</th>
<th style="text-align:center;">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">0</td>
<td style="text-align:center;">成功</td>
</tr>
<tr>
<td style="text-align:center;">4001</td>
<td style="text-align:center;">请求失败</td>
</tr>
<tr>
<td style="text-align:center;">4002</td>
<td style="text-align:center;">参数错误</td>
</tr>
<tr>
<td style="text-align:center;">4008</td>
<td style="text-align:center;">无权限</td>
</tr>
<tr>
<td style="text-align:center;">4009</td>
<td style="text-align:center;">未登录</td>
</tr>
</tbody>
</table>
<h2 id="-1">超级管理员：</h2>
<p>账号/密码：administrator/Qwe123</p>
<h2 id="-2">接口列表：</h2>
<table>
<thead>
<tr>
<th>功能</th>
<th>地址</th>
<th style="text-align:center;">方法</th>
<th>参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>图形验证码</td>
<td>/captcha</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>登录</td>
<td>/login</td>
<td style="text-align:center;">POST</td>
<td>*username、*password、*code(验证码)</td>
</tr>
<tr>
<td>退出登录</td>
<td>/logout</td>
<td style="text-align:center;">POST</td>
<td>-</td>
</tr>
<tr>
<td>修改密码</td>
<td>/password/reset</td>
<td style="text-align:center;">POST</td>
<td>*old_password(旧密码)、*new_password(新密码)</td>
</tr>
<tr>
<td>当前登陆用户的相关信息(含权限)</td>
<td>/who</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>上传图片</td>
<td>/upload</td>
<td style="text-align:center;">POST</td>
<td>*file(formData对象中的文件字段)</td>
</tr>
<tr>
<td>CKEditor上传图片</td>
<td>/upload/ckeditor</td>
<td style="text-align:center;">POST</td>
<td>*file</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>权限备选列表</td>
<td>/permission/list</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>角色列表</td>
<td>/role/list</td>
<td style="text-align:center;">GET</td>
<td>page(当前页码,以0开始)、limit(每页条数)、name(按名称搜索)</td>
</tr>
<tr>
<td>角色详情(数据中有该角色已分配的权限)</td>
<td>/role/detail</td>
<td style="text-align:center;">GET</td>
<td>*id</td>
</tr>
<tr>
<td>添加角色</td>
<td>/role/add</td>
<td style="text-align:center;">POST</td>
<td>*name(名称)、desc(描述)</td>
</tr>
<tr>
<td>编辑角色</td>
<td>/role/edit</td>
<td style="text-align:center;">POST</td>
<td>*id、*name、desc</td>
</tr>
<tr>
<td>删除角色</td>
<td>/role/delete</td>
<td style="text-align:center;">POST</td>
<td>*id</td>
</tr>
<tr>
<td>给角色分配权限</td>
<td>/role/set</td>
<td style="text-align:center;">POST</td>
<td>*id、*permissions(权限列表，数据格式为['admin.user.read', 'admin.role.create'])</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>用户列表(管理员)</td>
<td>/user/list</td>
<td style="text-align:center;">GET</td>
<td>page(当前页码,以0开始)、limit(每页条数)、username(按用户名搜索)</td>
</tr>
<tr>
<td>用户详情</td>
<td>/user/detail</td>
<td style="text-align:center;">GET</td>
<td>*id</td>
</tr>
<tr>
<td>添加用户</td>
<td>/user/add</td>
<td style="text-align:center;">POST</td>
<td>*username(用户名/账号)、*password(密码)、*avatar(头像图片路径)、role_ids(角色id列表，数据格式为[1, 3])、*tel(电话)、*mail(邮箱)、desc(描述)</td>
</tr>
<tr>
<td>编辑用户</td>
<td>/user/edit</td>
<td style="text-align:center;">POST</td>
<td>*id、*username、*avatar、role_ids、*tel、*mail、desc</td>
</tr>
<tr>
<td>删除用户</td>
<td>/user/delete</td>
<td style="text-align:center;">POST</td>
<td>*id</td>
</tr>
<tr>
<td>重置用户密码</td>
<td>/user/password</td>
<td style="text-align:center;">POST</td>
<td>*id、*password</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>分类标签备选列表</td>
<td>/category/tag/list</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>分类列表</td>
<td>/category/list</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>分类详情</td>
<td>/category/detail</td>
<td style="text-align:center;">GET</td>
<td>*id</td>
</tr>
<tr>
<td>添加分类</td>
<td>/category/add</td>
<td style="text-align:center;">POST</td>
<td>*name(名称)、tag(标签)、desc(描述)</td>
</tr>
<tr>
<td>编辑分类</td>
<td>/category/edit</td>
<td style="text-align:center;">POST</td>
<td>*id、*name、tag、desc</td>
</tr>
<tr>
<td>删除分类</td>
<td>/category/delete</td>
<td style="text-align:center;">POST</td>
<td>*id</td>
</tr>
<tr>
<td>调整分类顺序</td>
<td>/category/order</td>
<td style="text-align:center;">POST</td>
<td>*id、*direction(上移'up'，下移'down')</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>商品列表</td>
<td>/product/list</td>
<td style="text-align:center;">GET</td>
<td>page(当前页码,以0开始)、limit(每页条数)、name(按商品名称搜索)、category_id(按分类ID搜索，显示全部分类可以传0或者不传)、status(按商品状态ID搜索，1未提交 2待审核 3审核通过 4审核拒绝，显示全部状态可以传0或者不传)</td>
</tr>
<tr>
<td>商品详情</td>
<td>/product/detail</td>
<td style="text-align:center;">GET</td>
<td>*id</td>
</tr>
<tr>
<td>添加商品</td>
<td>/product/add</td>
<td style="text-align:center;">POST</td>
<td>*name(商品名称)、*category_id(分类ID)、tags(商品标签列表，数据格式为['人气爆品', '奈雪经典'])、*pic(商品图片路径)、*detail(商品介绍)、desc(备注信息)</td>
</tr>
<tr>
<td>编辑商品</td>
<td>/product/edit</td>
<td style="text-align:center;">POST</td>
<td>*id、*name、*category_id、*create_time(商品创建时间，数据格式为yyyy-MM-dd HH:mm:ss)、tags、*pic、*detail、desc</td>
</tr>
<tr>
<td>删除商品</td>
<td>/product/delete</td>
<td style="text-align:center;">POST</td>
<td>*id</td>
</tr>
<tr>
<td>提交送审商品</td>
<td>/product/submit</td>
<td style="text-align:center;">POST</td>
<td>*id</td>
</tr>
<tr>
<td>审核商品</td>
<td>/product/approve</td>
<td style="text-align:center;">POST</td>
<td>*id、*approve(审核通过true, 审核拒绝false)、msg(审核说明)</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>已上架商品列表</td>
<td>/sale/list</td>
<td style="text-align:center;">GET</td>
<td>page、limit、name、category_id</td>
</tr>
<tr>
<td>待上架商品列表(即审核通过并且未上架的)</td>
<td>/product/unpublish-list</td>
<td style="text-align:center;">GET</td>
<td>page、limit、name、category_id</td>
</tr>
<tr>
<td>上架商品(批量操作)</td>
<td>/sale/publish</td>
<td style="text-align:center;">POST</td>
<td>*products(商品列表，数据格式为[{ id: 1, price: 8.88, stock: 99 }]，即要上架商品的ID、价格和库存)</td>
</tr>
<tr>
<td>下架商品</td>
<td>/sale/unpublish</td>
<td style="text-align:center;">POST</td>
<td>*id</td>
</tr>
<tr>
<td>调整商品</td>
<td>/sale/adjust</td>
<td style="text-align:center;">POST</td>
<td>*id、*price、*stock、*sale_time(商品上架时间，数据格式为yyyy-MM-dd HH:mm:ss)</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>当前订单(已支付/待取餐的订单)</td>
<td>/order/current</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>历史订单(已完成/已取消的订单)</td>
<td>/order/history</td>
<td style="text-align:center;">GET</td>
<td>page、limit、order_number(订单号)、status(按订单状态ID搜索，4已完成 5已取消，显示全部状态可以传0或者不传)</td>
</tr>
<tr>
<td>设置订单状态</td>
<td>/order/status</td>
<td style="text-align:center;">POST</td>
<td>*id、*status(订单状态，3待取餐 4已完成)</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>总数统计</td>
<td>/chart/overview</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>最近一周的会员/订单数量</td>
<td>/chart/week</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>注：带*的为必填字段</p>
<h2 id="-3">路由权限：</h2>
<table>
<thead>
<tr>
<th style="text-align:center;">页面</th>
<th style="text-align:center;">路由</th>
<th style="text-align:center;">权限ids</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">首页</td>
<td style="text-align:center;">/main/home</td>
<td style="text-align:center;">所有登录用户</td>
</tr>
<tr>
<td style="text-align:center;">角色管理</td>
<td style="text-align:center;">/main/admin/role</td>
<td style="text-align:center;">['admin.role.read']</td>
</tr>
<tr>
<td style="text-align:center;">用户管理</td>
<td style="text-align:center;">/main/admin/user</td>
<td style="text-align:center;">['admin.user.read']</td>
</tr>
<tr>
<td style="text-align:center;">分类管理</td>
<td style="text-align:center;">/main/shop/category</td>
<td style="text-align:center;">['shop.category.read']</td>
</tr>
<tr>
<td style="text-align:center;">商品管理</td>
<td style="text-align:center;">/main/shop/product</td>
<td style="text-align:center;">['shop.product.read']</td>
</tr>
<tr>
<td style="text-align:center;">上架下架</td>
<td style="text-align:center;">/main/shop/sale</td>
<td style="text-align:center;">['shop.sale.read']</td>
</tr>
<tr>
<td style="text-align:center;">备餐配餐</td>
<td style="text-align:center;">/main/sale/order/current</td>
<td style="text-align:center;">['sale.order.current']</td>
</tr>
<tr>
<td style="text-align:center;">历史订单</td>
<td style="text-align:center;">/main/sale/order/history</td>
<td style="text-align:center;">['sale.order.history']</td>
</tr>
</tbody>
</table>
<h2 id="-4">功能权限：</h2>
<table class="c">
<thead>
<tr>
<th>页面</th>
<th>功能</th>
<th>权限ids</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="4">角色管理</td>
<td>添加按钮</td>
<td>['admin.role.create']</td>
</tr>
<tr>
<td>编辑按钮</td>
<td>['admin.role.update']</td>
</tr>
<tr>
<td>删除按钮</td>
<td>['admin.role.delete']</td>
</tr>
<tr>
<td>授权按钮</td>
<td>['admin.role.permission']</td>
</tr>
<tr>
<td rowspan="4">用户管理</td>
<td>添加按钮</td>
<td>['admin.user.create']</td>
</tr>
<tr>
<td>编辑按钮</td>
<td>['admin.user.update']</td>
</tr>
<tr>
<td>删除按钮</td>
<td>['admin.user.delete']</td>
</tr>
<tr>
<td>重置密码按钮</td>
<td>['admin.user.password']</td>
</tr>
<tr>
<td rowspan="4">分类管理</td>
<td>添加按钮</td>
<td>['shop.category.create']</td>
</tr>
<tr>
<td>编辑按钮</td>
<td>['shop.category.update']</td>
</tr>
<tr>
<td>删除按钮</td>
<td>['shop.category.delete']</td>
</tr>
<tr>
<td>调整顺序按钮</td>
<td>['shop.category.order']</td>
</tr>
<tr>
<td rowspan="5">商品管理</td>
<td>添加按钮</td>
<td>['shop.product.create']</td>
</tr>
<tr>
<td>编辑按钮</td>
<td>['shop.product.edit']</td>
</tr>
<tr>
<td>删除按钮</td>
<td>['shop.product.delete']</td>
</tr>
<tr>
<td>提交按钮</td>
<td>['shop.product.submit']</td>
</tr>
<tr>
<td>审核按钮</td>
<td>['shop.product.approve']</td>
</tr>
<tr>
<td rowspan="3">上架下架</td>
<td>上架按钮</td>
<td>['shop.sale.publish']</td>
</tr>
<tr>
<td>下架按钮</td>
<td>['shop.sale.unpublish']</td>
</tr>
<tr>
<td>调整按钮</td>
<td>['shop.sale.adjust']</td>
</tr>
<tr>
<td>备餐配餐</td>
<td>确定完成/取餐按钮</td>
<td>['sale.order.status']</td>
</tr>
</tbody>
</table>
<hr class="wechat"/>
<h1 id="-5">奈雪点单小程序端接口：</h1>
<p>请求统一前缀：
<a href="http://shop.datong0.com/api/wechat">http://shop.datong0.com/api/wechat</a></p>
<p>接口使用自定义请求头token鉴权</p>
<h2 id="-6">接口列表：</h2>
<table>
<thead>
<tr>
<th>功能</th>
<th>地址</th>
<th style="text-align:center;">方法</th>
<th>参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>凭证code换用户登录态token</td>
<td>/login</td>
<td style="text-align:center;">POST</td>
<td>*code(通过wx.login获取的凭证)<br>*appId(测试用)<br>*appSecret(测试用)</td>
</tr>
<tr>
<td>设置用户信息</td>
<td>/profile</td>
<td style="text-align:center;">POST</td>
<td>*userInfo(通过wx.getUserProfile获取的用户信息对象)</td>
</tr>
<tr>
<td>获取用户信息</td>
<td>/profile</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>商品列表</td>
<td>/product/list</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>商品详情</td>
<td>/product/detail</td>
<td style="text-align:center;">GET</td>
<td>*id</td>
</tr>
<tr>
<td>商品搜索</td>
<td>/product/search</td>
<td style="text-align:center;">POST</td>
<td>*keyword</td>
</tr>
<tr>
<td></td>
<td></td>
<td style="text-align:center;"></td>
<td></td>
</tr>
<tr>
<td>提交订单(订单结算点击“付款”时调用，返回信息中包含pay_info)</td>
<td>/order</td>
<td style="text-align:center;">POST</td>
<td>*phone(手机号)<br>*meal_time(取餐时间，'立即取餐')<br>*meal_type(就餐方式，'店内堂食'或者'打包带走')<br>*products(商品列表，数据格式为[{ id: 1, count: 2 }]，即要购买商品的ID和数量)<br>*pay_type(支付方式，'微信支付')<br>desc(备注)</td>
</tr>
<tr>
<td>当前订单(未完成/未取消的订单，待支付的订单会返回pay_info)</td>
<td>/order/current</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>历史订单(已完成/已取消的订单)</td>
<td>/order/history</td>
<td style="text-align:center;">GET</td>
<td>-</td>
</tr>
<tr>
<td>订单详情</td>
<td>/order/detail</td>
<td style="text-align:center;">GET</td>
<td>*id</td>
</tr>
<tr>
<td>取消订单(待支付状态的订单可以取消)</td>
<td>/order/cancel</td>
<td style="text-align:center;">POST</td>
<td>*id、*desc(取消原因)</td>
</tr>
</tbody>
</table>
<p>注：带*的为必填字段</p>
<p>~</p>
<script>
document.querySelector('.tab button:first-child').addEventListener('click', () => {
  document.querySelector('hr.admin').scrollIntoView();
});
document.querySelector('.tab button:last-child').addEventListener('click', () => {
  document.querySelector('hr.wechat').scrollIntoView();
});
</script>
</body></html>
